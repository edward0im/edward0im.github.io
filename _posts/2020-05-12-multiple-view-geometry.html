---
layout: post
title: (Geometry) Notes on Multiple View Geometry
description:
date: 2020-05-12
categories: [Mathematics]
tag: [Photogrammetry, Geometry, Computer Vision, SLAM]
use_math: true
comments: true
---
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgf7e3dfb">1. More Single View Geometry</a>
<ul>
<li><a href="#orgd03db8e">1.1. Camera calibration and the image of the absolute conic</a>
<ul>
<li><a href="#org2321c0d">1.1.1. Result 8.15</a></li>
<li><a href="#org1f0200b">1.1.2. Result 8.16</a></li>
</ul>
</li>
<li><a href="#org1fd60af">1.2. The image of the absolute conic</a></li>
<li><a href="#org8333916">1.3. Orthogonality and $\mathbf{w}$</a></li>
<li><a href="#org58a08d7">1.4. Vanishing points and vanishing lines</a>
<ul>
<li><a href="#org944b5c4">1.4.1. Camera rotation from vanishing points</a></li>
</ul>
</li>
<li><a href="#orgd018b92">1.5. Vanishing Lines</a></li>
<li><a href="#orge72b6aa">1.6. Orthogonality relationships amongst vanishing points and lines</a></li>
<li><a href="#org0f58b29">1.7. Affine 3D measurements and reconstruction</a></li>
<li><a href="#org0be45e6">1.8. Determining camera calibration $\mathbf{K}$from a single view</a></li>
<li><a href="#org08edbf3">1.9. Calibration from three orthogonal vanishing points</a></li>
<li><a href="#org010aaf8">1.10. Computation of focal length and principal point using vanishing point and vanishing line</a></li>
<li><a href="#orgc7a1329">1.11. The calibrating conic</a></li>
</ul>
</li>
<li><a href="#orge43955e">2. Epipolar Geometry and the Fundamental Matrix</a>
<ul>
<li><a href="#orgcd72ba2">2.1. Proof</a></li>
<li><a href="#org0da129e">2.2. Derivation of Fundemantal Matrix(Geometry)</a></li>
<li><a href="#org8bc1244">2.3. Derivation of Fundemantal Matrix(Algebraic)</a></li>
</ul>
</li>
<li><a href="#org5816cc3">3. References</a></li>
<li><a href="#org6d8d6e0">4. Closure</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgf7e3dfb" class="outline-2">
<h2 id="orgf7e3dfb"><span class="section-number-2">1</span> More Single View Geometry</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgd03db8e" class="outline-3">
<h3 id="orgd03db8e"><span class="section-number-3">1.1</span> Camera calibration and the image of the absolute conic</h3>
<div class="outline-text-3" id="text-1-1">
<hr />
</div>
<div id="outline-container-org2321c0d" class="outline-4">
<h4 id="org2321c0d"><span class="section-number-4">1.1.1</span> Result 8.15</h4>
<div class="outline-text-4" id="text-1-1-1">
<hr />
<p>
원점에 위치한 카메라가 있을 때 한 점 $\mathbf{x}$를 Back-projection하면 카메라 중심을 지나는 직선 $\mathbf{d}$가 생성되는데 이 때, $\mathbf{d}= \mathbf{K}^{-1}\mathbf{x}$의 관계를 가진다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{x} &amp; = \mathbf{P} \begin{bmatrix} \lambda \mathbf{d} \\ 1 \end{bmatrix} \\
    &amp; = \mathbf{K} [ \mathbf{I} | 0 ] \begin{bmatrix} \lambda \mathbf{d} \\ 1 \end{bmatrix} = \mathbf{Kd} \\
  \end{aligned}
\end{equation}
<p>
따라서 다음의 공식이 성립한다.
</p>

\begin{equation}
  \begin{aligned}
    &amp; \mathbf{x} = \mathbf{Kd} \\
    &amp; \mathbf{d} = \mathbf{K}^{-1}\mathbf{x}
  \end{aligned}
\end{equation}
<p>
이미지 평면 상의 두 점 $\mathbf{x}_{1}, \mathbf{x}_{2}$를 Back-projection하면 각각 $\mathbf{d}_{1}, \mathbf{d}_{2}$의 직선이 생성되는데 이 때 두 직선이 이루는 각도는 다음과 같이 계산할 수 있다.
</p>

\begin{equation}
  \begin{aligned}
    \cos\theta &amp; = \frac{\mathbf{d}_{1}^{T}\mathbf{d}_{2}}{\sqrt{\mathbf{d}_{1}^{T}\mathbf{d}_{1}}\sqrt{\mathbf{d}_{2}^{T}\mathbf{d}_{2}}} = \frac{(\mathbf{K}^{-1}\mathbf{x}_{1})^{T}(\mathbf{K}^{-1}\mathbf{x}_{2})}{\sqrt{(\mathbf{K}^{-1}\mathbf{x}_{1})^{T}(\mathbf{K}^{-1}\mathbf{x}_{1})}\sqrt{(\mathbf{K}^{-1}\mathbf{x}_{2})^{T}(\mathbf{K}^{-1}\mathbf{x}_{2})}} \\
    &amp; = \frac{\mathbf{x}_{1}^{T}(\mathbf{K}^{-T}\mathbf{K}^{-1})\mathbf{x}_{2}}{\sqrt{\mathbf{x}_{1}^{T}\mathbf{K}^{-T}\mathbf{K}^{-1}\mathbf{x}_{1}}\sqrt{\mathbf{x}_{2}^{T}\mathbf{K}^{-T}\mathbf{K}^{-1}\mathbf{x}_{2}}}
  \end{aligned}
\end{equation}
<p>
이 때, <b>$\mathbf{K}^{-T}\mathbf{K}^{-1}$은 Image of Absolute Conic</b> 을 의미한다.
</p>

<hr />
</div>
</div>
<div id="outline-container-org1f0200b" class="outline-4">
<h4 id="org1f0200b"><span class="section-number-4">1.1.2</span> Result 8.16</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
이미지 평면에 있는 직선 $\mathbf{l}$위에 한 점 $\mathbf{x}$가 위치할 때, 점과 직선 사이에는 다음 공식이 성립한다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{x}^{T}\mathbf{l} =0
  \end{aligned}
\end{equation}
<p>
이 때, $\mathbf{l}$를 Back-projection하면 평면 $&pi;$가 생성되고 $\mathbf{x}$를 Back-projection하면 $\mathbf{d}=\mathbf{K}^{-1}\mathbf{x}$가 생성되는데 평면 $&pi;$와 직선 $\mathbf{d}$사이에는 $(\mathbf{K}^{-1}\mathbf{x})^{T}&pi; = 0$이 성립하고 이를 정리하면 $\mathbf{x}^{T}(\mathbf{K}^{-T}&pi;)=0$가 성립한다. $\mathbf{x}^{T}\mathbf{l}=0$의 공식에 따라 결론적으로 다음 공식이 성립한다.
</p>

\begin{equation}
  \begin{aligned}
    &amp; \mathbf{K}^{-T}\pi  = \mathbf{l} \\
    &amp; \pi = \mathbf{K}^{T}\mathbf{l}
  \end{aligned}
\end{equation}
<hr />
</div>
</div>
</div>
<div id="outline-container-org1fd60af" class="outline-3">
<h3 id="org1fd60af"><span class="section-number-3">1.2</span> The image of the absolute conic</h3>
<div class="outline-text-3" id="text-1-2">
<p>
무한대 평면 $&pi;_{&infin;}$가 있을 때 $\pi_{\infty}$위에 위치한 무한대 점 $\mathbf{X}_{&infin;} = (\mathbf{d}^{T}, 0)^{T}$이 있다고 하면 이를 카메라 $\mathbf{P}=\mathbf{KR}[\mathbf{I}|-~{\mathbf{C}}]$에 프로젝션시키면 다음과 같다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{x} = \mathbf{PX}_{\infty} = \mathbf{KR}[\mathbf{I} | -\tilde{\mathbf{C}}] \begin{bmatrix} \mathbf{d} \\0 \end{bmatrix} = \mathbf{KRd}
  \end{aligned}
\end{equation}
<p>
이는 곧 무한대 평면 $\pi_{\infty}$위의 점 $\mathbf{d}$에 대해 $\mathbf{x}= \mathbf{Hd}$인 Homography가 존재한다고 했을 때 Homography를 다음과 같이 구할 수 있다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{H} = \mathbf{KR}
  \end{aligned}
\end{equation}
<p>
무한대에 위치한 Absolute Conic $&Omega;_{&infin;}$는 $\mathbf{I}_{3}&isin; &pi;_{&infin;}$이다. $&Omega;_{&infin;}$를 Homography 변환하면
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{H}(\Omega_{\infty}) &amp; = \mathbf{H}^{-T}\mathbf{I}_{3}\mathbf{H}^{-1} \\
    &amp; = (\mathbf{KR})^{-T}\mathbf{I}_{3}(\mathbf{KR})^{-1} \\
    &amp; = \mathbf{K}^{-T}\mathbf{R}^{-T}\mathbf{R}^{-1}\mathbf{K}^{-1} \\
    &amp; = \mathbf{K}^{-T}\mathbf{K}^{-1} 
  \end{aligned}
\end{equation}
<p>
즉, <b>Image of Absolute Conic $\mathbf{w} = \mathbf{K}^{-T}\mathbf{K}^{-1}$</b> 이 된다.
</p>

<p>
이미지 상의 두 점 $\mathbf{x}_{1}, \mathbf{x}_{2}$를 Back-projection 했을 때, 두 직선이 이루는 각도는
</p>

\begin{equation}
  \begin{aligned}
    \cos\theta = \frac{\mathbf{x}_{1}^{T}\mathbf{w}\mathbf{x}_{2}}{\sqrt{\mathbf{x}_{1}^{T}\mathbf{w}\mathbf{x}_{2}}\sqrt{\mathbf{x}_{2}^{T}\mathbf{w}\mathbf{x}_{2}}}
  \end{aligned}
\end{equation}
<p>
가 되고 이를 Homography 변환하면
</p>

\begin{equation}
  \begin{aligned}
    \cos\theta = \frac{(\mathbf{Hx}_{1})^{T}\mathbf{H}^{-T}\mathbf{w}\mathbf{H}^{-1}(\mathbf{Hx}_{2})}{\sqrt{*}\sqrt{*}}
  \end{aligned}
\end{equation}
<p>
이 되므로 Homography 변환을 해도 두 각도는 여전히 보존된다. 만약 두 직선 $\mathbf{K}^{-1}\mathbf{x}_{1}$과 $\mathbf{K}^{-1}\mathbf{x}_{2}$가 직교하는 경우 다음 공식이 성립한다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{x}_{1}^{T}\mathbf{w}\mathbf{x}_{2} = 0
  \end{aligned}
\end{equation}
<hr />
</div>
</div>
<div id="outline-container-org8333916" class="outline-3">
<h3 id="org8333916"><span class="section-number-3">1.3</span> Orthogonality and $\mathbf{w}$</h3>
<div class="outline-text-3" id="text-1-3">
<p>
이미지 평면 상의 두 점 $\mathbf{x}_{1}, \mathbf{x}_{2}$를 Back-projection하면 두 직선 $\mathbf{K}^{-1}\mathbf{x}_{1}, \mathbf{K}^{-1}\mathbf{x}_2$가 생성된다. 만약 두 직선이 직교하는 경우 $\mathbf{x}_{1}^{T}\mathbf{w}\mathbf{x}_{2}=0$의 공식이 성립한다. 그리고 $\mathbf{x}_{1}$가 직선 $\mathbf{l}$에 포함되어 있으면 $\mathbf{x}_{1}^{T}\mathbf{l}=0$이 성립한다. 위 두 공식을 결합하면
</p>

\begin{equation}
  \begin{aligned}
    &amp; \mathbf{x}_{1}^{T}\mathbf{w}\mathbf{x}_{2}=0 \\
    &amp; \mathbf{x}_{1}^{T}\mathbf{l} = 0 \\
    &amp; \therefore \mathbf{l} = \mathbf{wx}_{2}
  \end{aligned}
\end{equation}
<hr />
</div>
</div>
<div id="outline-container-org58a08d7" class="outline-3">
<h3 id="org58a08d7"><span class="section-number-3">1.4</span> Vanishing points and vanishing lines</h3>
<div class="outline-text-3" id="text-1-4">
<p>
3차원 공간 상의 점 $\mathbf{A}$와 직선의 방향 $\mathbf{D}=(\mathbf{d}^{T},0)^{T}$가 존재할 때 직선 위에 존재하는 점 $\mathbf{X}(&lambda;)$는 다음과 같이 정의된다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{X}(\lambda) = \mathbf{A} + \lambda \mathbf{D} = \begin{bmatrix} \tilde{\mathbf{A}} + \lambda \mathbf{d} \\ 1 \end{bmatrix}
  \end{aligned}
\end{equation}
<p>
점 $\mathbf{X}(&lambda;)$를 이미지 평면에 프로젝션한 점 $\mathbf{x}(&lambda;) = \mathbf{PX}(&lambda;), \ \ \text{where }\ \mathbf{P}= \mathbf{K}[\mathbf{I}|0]$는 다음과 같이 정의된다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{x}(\lambda) = \mathbf{PX}(\lambda) = \mathbf{PA} + \lambda \mathbf{PD} = \mathbf{a} + \lambda \mathbf{Kd}
  \end{aligned}
\end{equation}
<p>
이 때, $\mathbf{a}$는 Image of $\mathbf{A}$를 의미한다. 결론적으로 소실점(Vanishing Point) $\mathbf{v}$는 다음과 같이 정의된다.
</p>

\begin{equation}
  \begin{aligned}
    &amp; \mathbf{v} = \lim_{\lambda \rightarrow \infty}\mathbf{x}(\lambda) = \lim_{\lambda \rightarrow \infty}(\mathbf{a} + \lambda \mathbf{Kd}) = \mathbf{Kd} \\
    &amp; \mathbf{v} = \mathbf{Kd}
  \end{aligned}
\end{equation}
<hr />
</div>
<div id="outline-container-org944b5c4" class="outline-4">
<h4 id="org944b5c4"><span class="section-number-4">1.4.1</span> Camera rotation from vanishing points</h4>
<div class="outline-text-4" id="text-1-4-1">
<p>
소실점을 사용하여 카메라의 회전을 계산할 수 있다. 이미지 1에서 추출한 소실점 $\mathbf{v}_{1}$과 이미지 2에서 추출한 소실점 $\mathbf{v}_{2}$이 있을 때, $\mathbf{v}_{1}$의 방향은 $\mathbf{d}_{1} = \mathbf{K}^{-1}\mathbf{v}_{1}$이 되고 $\mathbf{v}_{2}$의 방향은 $\mathbf{d}_{2} = \mathbf{K}^{-1}\mathbf{v}_{2}$가 된다.
</p>

<p>
$\mathbf{K}, \mathbf{v}_{1}, \mathbf{v}_{2}$의 값을 모두 알고 있다고 가정하면 $\mathbf{d}_{1}, \mathbf{d}_{2}$의 값을 계산할 수 있게 되고 두 방향벡터는 다음과 같은 관계를 가진다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{d}_{2} = \mathbf{Rd}_{2}
  \end{aligned}
\end{equation}
<p>
이 때, <b>회전행렬 $\mathbf{R}$의 자유도는 3이므로 2개 이상의 소실점 쌍을 사용하면 회전행렬을 복원</b> 할 수 있다.
</p>

<hr />
</div>
</div>
</div>
<div id="outline-container-orgd018b92" class="outline-3">
<h3 id="orgd018b92"><span class="section-number-3">1.5</span> Vanishing Lines</h3>
<div class="outline-text-3" id="text-1-5">
<p>
두 개 이상의 소실점(Vanishing Point) $\mathbf{v}_{i}, i=1,2,\cdots$들을 이어준 직선을 소실선(Vanishing Line) $\mathbf{l}$이라고 한다. 예를 들어 이미지 상의 체크보드가 있고 이로 인해 2개의 소실점 $\mathbf{v}_{1}, \mathbf{v}_{2}$를 구한 경우를 생각해보자. 이 경우, <b>두 소실점 $\mathbf{v}_{1},\mathbf{v}_{2}$를 이어주는 직선 $\mathbf{l}$을 체크보드 평면 $&pi;$의 소실선</b> 이라고 한다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{l} = \text{image of } \pi \cap \pi_{\infty}
  \end{aligned}
\end{equation}
<p>
결론적으로 <b>소실선 $\mathbf{l}$은 카메라 중심을 포함하고 체크보드 평면 $&pi;$과 평행인 평면 $&pi;^{'}$와 이미지 평면의 교집합</b> 을 의미한다. $&pi;^{'}$은 소실선 $\mathbf{l}$을 Back-projection함으로써 계산할 수 있다. 이 때 평면과 직선의 관계에 따라
</p>

\begin{equation}
  \begin{aligned}
    \pi^{'} = \mathbf{K}^{T}\mathbf{l}
  \end{aligned}
\end{equation}
<p>
과 같이 계산할 수 있다.
</p>

<hr />
</div>
</div>
<div id="outline-container-orge72b6aa" class="outline-3">
<h3 id="orge72b6aa"><span class="section-number-3">1.6</span> Orthogonality relationships amongst vanishing points and lines</h3>
<div class="outline-text-3" id="text-1-6">
<p>
이미지 평면에서 두 개의 소실점 $\mathbf{v}_{1}, \mathbf{v}_{2}$을 Back-projection한 직선들이 서로 직교하는 조건은 다음과 같다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{v}_{1}^{T}\mathbf{w}\mathbf{v}_{2} = 0
  \end{aligned}
\end{equation}
<p>
이 때, $\mathbf{w}= \mathbf{K}^{-T}\mathbf{K}^{-1}$은 Image of Absolute Conic이다.
</p>

<p>
이미지 평면에서 소실점 $\mathbf{v}$을 Back-projection한 직선과 소실선 $\mathbf{l}$을 Back-projection한 평면이 직교하는 조건은 다음과 같다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{l} = \mathbf{w}\mathbf{v}
  \end{aligned}
\end{equation}
<p>
이미지 평면에서 두 개의 직선 $\mathbf{l}_{1}, \mathbf{l}_{2}$를 Back-projection한 두 평면들이 서로 직교하는 경우 다음을 만족한다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{l}_{1}^{T}\mathbf{w}^{*}\mathbf{l}_{2} =0
  \end{aligned}
\end{equation}
<p>
이 때, $\mathbf{w}^{*}$는 Image of Dual Absolute Conic이다.
</p>

<hr />
</div>
</div>
<div id="outline-container-org0f58b29" class="outline-3">
<h3 id="org0f58b29"><span class="section-number-3">1.7</span> Affine 3D measurements and reconstruction</h3>
<div class="outline-text-3" id="text-1-7">
<p>
3차원 공간 상의 평면 $&pi;$에 수직인 물체들의 소실점을 수직소실점(Vertical Vanishing Point) $\mathbf{v_{&perp;}}$라고 한다. 평면 $&pi;$의 소실선 $\mathbf{l}$과 수직소실점을 이용하면 물체의 크기를 Up to Scale까지 계산할 수 있다. 정확하게 말하면 <b>소실선 $\mathbf{l}$과 수직소실점 $\mathbf{v}_{&perp;}$를 알면 평면 $&pi;$에 수직한 선분들의 상대적 길이를 알 수 있다.</b>
</p>

<p>
예를 들면, 3차원 공간 상의 평면 $&pi;$에 위치한 두 점 $\mathbf{B}_{1}, \mathbf{B}_{2}$가 있고 이를 지나면서 $&pi;$에 수직인 직선 $\mathbf{L}_{1}, \mathbf{L}_{2}$가 있다고 가정한다. 그리고 두 직선 $\mathbf{L}_{1}, \mathbf{L}_{2}$의 끝점 $\mathbf{T}_{1}, \mathbf{T}_{2}$가 있을 경우 <b>소실선 $\mathbf{l}$과 수직소실점 $\mathbf{v}_{&perp;}$를 사용하여 $\mathbf{T}_{1}, \mathbf{T}_{2}$의 상대적 길이를 측정</b> 할 수 있다.
</p>

<p>
우선, 모든 요소들을 이미지 평면에 프로젝션시킨다. 이 때, $\mathbf{b}_{1}, \mathbf{b}_{2}$를 잇는 직선과 소실선 $\mathbf{l}$이 만나는 점을 $\mathbf{u}$라고 정의한다. 그리고 $\mathbf{t}_{1}$에서 $\bar{\mathbf{b}_{1}\mathbf{b}_{2}}$에 평행한 직선을 그으면 해당 직선은 $\mathbf{u}$와 접한다. 이 때 $\bar{\mathbf{t}_{1}\mathbf{u}}$와 $\mathbf{v}_{&perp;}\mathbf{b}_{2}$가 만나는 교점을 $~{\mathbf{t}}_{1}$이라고 한다.
</p>

<p>
다음으로 $\bar{\mathbf{v}_{\perp}\mathbf{b}_{2}}$직선을 $\mathbb{P}^{1}$공간의 수직소실점 $\mathbf{v}_{&perp;}$는 무한대의 점 $(1,0)$이 되고 $\mathbf{b}_{1}$은 원점 $(0,1)$되는 직선으로 프로젝션시킨다. 이 때 사용하는 Homography $\mathbf{H}_{2&times;2}$는 다음과 같다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{H}_{2\times2} = \begin{bmatrix} 1 &amp; 0 \\ 1 &amp; -\mathbf{v}_{\perp} \end{bmatrix}
  \end{aligned}
\end{equation}
<p>
$\mathbf{H}_{2&times;2}$는 Cross-Ratio를 보장한다. 다음으로 길이의 비를 이용하여 $d_{1} : d_{2} = \mathbf{b}_{1}~{\mathbf{t}}_{1}:\mathbf{b}_{1}\mathbf{t}_{2}$의 비율을 구한다.
</p>

\begin{equation}
  \begin{aligned}
    \frac{d_{1}}{d_{2}} = \frac{\tilde{\mathbf{t}}_{1}(\mathbf{v}_{\perp}-\mathbf{t}_{2})}{\mathbf{t}_{2}(\mathbf{v}_{\perp}-\tilde{\mathbf{t}}_{1})}
  \end{aligned}
\end{equation}
<p>
만약, 수직소실점 $\mathbf{v}_{&perp;}$와 카메라의 주축(Principal Axis)이 수직인 경우 이미지 상에서 수직소실점은 만나지 않게 되고 아래와 같이 단순하게 비율을 계산할 수 있다.
</p>

\begin{equation}
  \begin{aligned}
    \frac{d_{1}}{d_{2}} = \frac{\tilde{\mathbf{t}}_{1}-\mathbf{b}_{2}}{\mathbf{t}_{2}-\mathbf{b}_{2}}
  \end{aligned}
\end{equation}
<hr />
</div>
</div>
<div id="outline-container-org0be45e6" class="outline-3">
<h3 id="org0be45e6"><span class="section-number-3">1.8</span> Determining camera calibration $\mathbf{K}$from a single view</h3>
<div class="outline-text-3" id="text-1-8">
<p>
단안 이미지에서 내부 파라미터 $\mathbf{K}$를 결정하기 위해서는 2가지 제약조건이 필요하다. <b>이미지 제약조건(Scene Constraint)과 내부 파라미터의 제약조건(Internal Constraint)</b> 이 있다.
</p>

<p>
이미지 제약조건으로는 이미지 평면에 존재하는 서로 수직인 두 소실점 $\mathbf{v}_{1}, \mathbf{v}_{2}$가 있을 경우 $\mathbf{v}_{1}^{T}\mathbf{w}\mathbf{v}_{2}=0$가 있고, 소실선 $\mathbf{l}$과 소실점 $\mathbf{v}$가 직교하는 경우 이들의 Back-projection은 $\mathbf{l}= \mathbf{wx}$가 있다.
</p>

\begin{equation}
  \begin{aligned}
    &amp; \mathbf{v}_{1}^{T}\mathbf{w}\mathbf{v}_{2}=0 \\
    &amp; \mathbf{l} \times (\mathbf{wv}) = 0
  \end{aligned}
\end{equation}
<p>
내부 파라미터 제약조건으로는 $\mathbf{K}$가 Zero-Skew인 경우 $w_{12} = w_{21}=0$이 있고 또한, Square Pixels인 경우 $w_{12}=w_{21}=0, w_{11}=w_{22}$가 있다.
</p>

\begin{equation}
  \begin{aligned}
    &amp; w_{12} = w_{21} \quad \text{for zero skew} \\
    &amp; w_{12}=w_{21}=0, w_{11}=w_{22} \quad \text{for square pixel}
  \end{aligned}
\end{equation}
<p>
위와 같이 $\mathbf{w} = \begin{bmatrix} w_{1} &amp; w_{2} &amp; w_{4} \\ w_{2} &amp; w_{3} &amp;w_{5} \\ w_{4} &amp; w_{5} &amp; w_{6} \end{bmatrix}$파라미터를 찾기 위해 충분한 제약조건을 확보한 후 $\mathbf{w}$를 6차원 벡터로 정렬하여 $\mathbf{Ax}=0$형태의 선형 시스템을 만든다. 다음으로 <b>특이값 분해(SVD)를 사용하여 $\mathbf{w}=\mathbf{K}^{-T}\mathbf{K}^{-1}$값을 계산한 후 Cholesky Decomposition을 사용하여 $\mathbf{K}^{-T}\mathbf{K}^{-1}$를 분해</b> 한다. 이를 통해 내부 파라미터 $\mathbf{K}$를 계산할 수 있다.
</p>

<hr />
</div>
</div>
<div id="outline-container-org08edbf3" class="outline-3">
<h3 id="org08edbf3"><span class="section-number-3">1.9</span> Calibration from three orthogonal vanishing points</h3>
<div class="outline-text-3" id="text-1-9">
<p>
내부 파라미터 $\mathbf{K}$가 Zero-Skew이고 Square Pixel일 때 세 개의 서로 직교하는 수직소실점들 $\mathbf{v}_{i}, \ i=1,2,3$을 사용하여 $\mathbf{K}$를 계산할 수 있다. 우선 $\mathbf{K}$가 Zero-Skew이고 Square Pixel이므로 다음이 성립한다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{w} = \begin{bmatrix} w_{1} &amp; 0 &amp; w_{2} \\ 0 &amp; w_{1} &amp; w_{3} \\ w_{2} &amp; w_{3} &amp; w_{4} \end{bmatrix}
  \end{aligned}
\end{equation}
<p>
이와 같이 총 4개의 자유도를 가지므로 세 개의 수직소실점들을 사용하여 $\mathbf{K}$를 결정할 수 있다. 우선, 각각의 수직소실점들의 직교 특성을 사용하여 $\mathbf{v}_{i}^{T}\mathbf{w}\mathbf{v}_{j}, \ &forall; i&ne; j$를 계산한다. 이 때 $\mathbf{w}$를 벡터화하여 $\mathbf{Ax}=0$형태의 선형 시스템으로 변환한 후 Nul $(\mathbf{A})$를 계산함으로써 $\mathbf{w}$를 구한다. 다음으로 Cholesky Decomposition을 사용하여 $\mathbf{w}=\mathbf{K}^{-T}\mathbf{K}^{-1}$를 분해한다. 이와 같이 내부 파라미터 $\mathbf{K}$를 계산할 수 있다.
</p>

<hr />
</div>
</div>
<div id="outline-container-org010aaf8" class="outline-3">
<h3 id="org010aaf8"><span class="section-number-3">1.10</span> Computation of focal length and principal point using vanishing point and vanishing line</h3>
<div class="outline-text-3" id="text-1-10">
<p>
3차원 공간 상의 평면 $&pi;$로부터 구할 수 있는 소실선 $\mathbf{l}$이 있고 $&pi;$와 수직인 수직소실점 $\mathbf{v}_{&perp;}$가 있다고 하면 이를 활용하여 초점거리 f와 주점(Poincipal Point)를 구할 수 있다.
</p>

<p>
초점거리 f를 구하는 방법은 다음과 같다. 수직소실점을 $\mathbf{v}_{1}$이라고 하고 이미지 평면과 평면 $&pi;$의 교선을 $\mathbf{l}_{1}$이라고 하면 $\mathbf{v}_{1}\mathbf{C}$와 $\mathbf{xC}$는 서로 직교한다. 그리고 카메라 중심에서 이미지 평면으로 수선을 내린 점 P가 있으면 $\mathbf{CP}$의 길이가 곧 초점거리 f가 된다. <b>$\mathbf{v}_{1}x$를 지름으로 하는 원을 그린 후 점 $\mathbf{P}$에 수평으로 그린 선과 원의 교점을 각각 $\mathbf{a}, \mathbf{b}$라고 하면 두 점 중 하나가 곧 카메라의 중심 $\mathbf{C}$가 되고 이는 곧 $\mathbf{aP}= \mathbf{bP}$가 초점거리 f</b> 가 된다.
</p>

<p>
주점(Principal Point) P를 구하는 방법은 다음과 같다. 수직소실점을 $\mathbf{v}_{1}$라고 하고 이미지 평면과 $\pi$평면의 교선을 $\mathbf{l}_{1}$라고 하면 $\mathbf{v}_{1}$에서 $\mathbf{l}_{1}$에 수선을 내리면 해당 수선에 주점(Principal Point) P가 위치한다. 이러한 특징으로 인해 <b>서로 다른 세 개의 수직소실점이 존재하는 경우 이들의 수심(Orthocenter of the triangle)이 곧 주점 P가 된다.</b>
</p>

<hr />
</div>
</div>
<div id="outline-container-orgc7a1329" class="outline-3">
<h3 id="orgc7a1329"><span class="section-number-3">1.11</span> The calibrating conic</h3>
<div class="outline-text-3" id="text-1-11">
<p>
IAC(Image of Absolute Conic)은 이미지 평면의 점을 Back-projection한 직선들 간의 각도를 구할 수 있고 Metric Rectification도 수행할 수 있는 유용한 도구이지만 Circular Point의 특성 상 실수의 근을 갖지 않아서 시각화가 불가능하다는 단점이 있다. 이를 보완하기 위해 고안된 것이 Calibration Conic이다. Calibration Conic은 $X^{2}+Y^{2}=Z^{2}$의 Cone을 프로젝션시킨 Image Conic을 의미하고 시각화가 가능한 장점이 존재한다.
</p>

<p>
카메라 프로젝션 $\mathbf{P}= \mathbf{K}[\mathbf{I}|0]$이 있을 때 Calibration Conic 위의 점들은 다음과 같이 프로젝션된다.
</p>
\begin{equation}
  \begin{aligned}
    \mathbf{C} = \mathbf{K}^{-T}\begin{bmatrix} 1 &amp; &amp; \\ &amp; 1 &amp; \\ &amp; &amp; -1 \end{bmatrix}\mathbf{K}^{-1}
  \end{aligned}
\end{equation}
<p>
이 때, $\mathbf{D}= \begin{bmatrix}1 &amp; &amp; \\ &amp; 1 &amp; \\ &amp; &amp; -1 \end{bmatrix}$라고 하면 $\mathbf{C}= \mathbf{K}^{-T}\mathbf{D}\mathbf{K}^{-1}$와 같이 나타낼 수 있다. 만약 $\mathbf{K}= \begin{bmatrix}f &amp; &amp; \\ &amp; f &amp; \\ &amp; &amp; 1 \end{bmatrix}$인 경우 Calibration Conic은
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{C} = \begin{bmatrix} 1 &amp; &amp; \\ &amp; 1 &amp; \\ &amp; &amp; -f^{2} \end{bmatrix}
  \end{aligned}
\end{equation}
<p>
으로 나타낼 수 있고 이 때, <b>Calibration Conic은 원점이 주점(Principal Point)이면서 반지름이 초점거리 f인 이미지 상의 원</b> 을 의미한다.
</p>

<p>
$\mathbf{C}$를 분해하면 다음과 같이 다시 정의할 수 있다.
</p>

\begin{equation}
  \begin{aligned}
    &amp; \mathbf{C} = \mathbf{K}^{-T}\mathbf{DK}^{-1} = \mathbf{K}^{-T}\mathbf{K}^{-1}\mathbf{KDK}^{-1} \\
    &amp; \mathbf{C} = \mathbf{w}\mathbf{S} \quad \text{where, } \mathbf{S} = \mathbf{KDK}^{-1}
  \end{aligned}
\end{equation}
<p>
이 때 이미지 상의 임의의 점 $\mathbf{x}=\mathbf{K}~{\mathbf{X}}$에 대하여 $\mathbf{Sx}$는 Calibration Conic에 의해 반사된 점(Reflected Point)을 의미한다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{Sx} &amp; = \mathbf{KDK}^{-1}\mathbf{K}\tilde{\mathbf{X}} \\
    &amp; = \mathbf{KD}\begin{bmatrix} X \\ Y \\ Z \end{bmatrix} = \mathbf{K}\begin{bmatrix} X \\ Y \\ -Z \end{bmatrix}
  \end{aligned}
\end{equation}
<p>
이미지 평면 상의 두 점 $\mathbf{x}, \mathbf{x}^{'}$에 대하여 두 점의 Back-projection된 직선들이 서로 직교하는 경우 $\mathbf{x}^{'T}\mathbf{wx}=0$이 성립한다. 이 식을 다시 작성하면
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{x}^{'T}\mathbf{wx} = \mathbf{x}^{'T}\mathbf{CS}^{-1}\mathbf{x} = \mathbf{x}^{'T}\mathbf{CSx} = \mathbf{x}^{'T}\mathbf{C}\dot{\mathbf{x}}
  \end{aligned}
\end{equation}
<p>
이 때, $\dot{\mathbf{x}} = \mathbf{Sx}$는 점 $\mathbf{x}$가 Calibration Conic에 의해 반사된 점을 의미한다. 결론적으로, <b>직선 $\mathbf{C}\dot{\mathbf{x}}$는 반사된 점 $\dot{\mathbf{x}}$와 Calibration Conic의 접선들을 이어주는 직선이 되고 점 $\mathbf{x}^{'}$는 직선 $\mathbf{C}\dot{\mathbf{x}}$위에 존재</b> 한다.
</p>

<hr />
</div>
</div>
</div>
<div id="outline-container-orge43955e" class="outline-2">
<h2 id="orge43955e"><span class="section-number-2">2</span> Epipolar Geometry and the Fundamental Matrix</h2>
<div class="outline-text-2" id="text-2">
<p>
Epipolar geometry는 <b>2개의 카메라 이미지 사이에 정의되는 기하학 관계</b> 를 의미한다. 이는 3차원 물체의 구조와는 독립적이며 <b>오로지 카메라의 내부 파라미터와 두 카메라 사이의 상대 포즈에만 의존한다.</b>
</p>

<p>
Fundamental Matrix는 <b>2개의 주어진 카메라의 중심점 $\mathbf{C}, \mathbf{C}^{'}$이 주어질 때 $\mathbf{F}&isin; \mathbb{R}^{3&times; 3}$이며 rank 2를 가지는 행렬</b> 을 의미한다. $\mathbf{F}$는 두 카메라의 이미지 평면에 있는 점들의 대응쌍 $\mathbf{x}, \mathbf{x}^{'}$에 대하여
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{x}^{'T}\mathbf{Fx} = 0
  \end{aligned}
\end{equation}
<p>
을 만족한다. 이 때 곱해지는 순서에 따라 의미가 달라지며 $\mathbf{x}^{'T}\mathbf{Fx}=0$인 경우 두 카메라 $\mathbf{C},\mathbf{C}^{'}$사이의 Fundamental Matrix라고 하고 $\mathbf{x}^{T}\mathbf{F}^{'}\mathbf{x}^{'}=0$인 경우 두 카메라 $\mathbf{C}^{'},\mathbf{C}$사이의 Fundamental Matrix라고 한다. 이 때, $\mathbf{F}^{T} = \mathbf{F}^{'}$관계가 성립한다.
</p>

<p>
기하학적 측면에서 보면, $\mathbf{x}^{'T}\mathbf{Fx}=0$에서 <b>$\mathbf{Fx}$는 카메라 $\mathbf{C}$의 이미지 평면 $\pi_{\mathbf{C}}$위의 점 $\mathbf{x}$가 존재할 때 이와 상응하는 Epipolar Line $\mathbf{l}^{'} &isin; &pi;_{\mathbf{C}^{'}}$을 의미</b> 한다. 따라서 <b>$\mathbf{F}$를 이미지 평면 위의 점을 Epipolar Line으로 매핑하는 함수로 생각</b> 할 수 있다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{F}: \ \mathbf{x} \in \pi_{\mathbf{C}} \in \mathbb{P}^{2} \mapsto \mathbf{l}^{'} \in (\mathbb{P}^{2})^{\vee}
  \end{aligned}
\end{equation}
<hr />
</div>
<div id="outline-container-orgcd72ba2" class="outline-3">
<h3 id="orgcd72ba2"><span class="section-number-3">2.1</span> Proof</h3>
<div class="outline-text-3" id="text-2-1">
<p>
($\Rightarrow$)$\mathbf{l}^{'} = \mathbf{Fx}$인 경우 Epipolar Line $\mathbf{l}^{'}$에 위치한 점 $\mathbf{x}^{'}$에 대하여 다음이 성립한다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{x}^{'T}\mathbf{l}^{'} = \mathbf{x}^{'T}\mathbf{Fx}=0 \quad \forall \mathbf{x} \leftrightarrow \mathbf{x}^{'}
  \end{aligned}
\end{equation}
<p>
($\Leftarrow$) 이미지 평면 $\pi_{\mathbf{C}}$위의 점 $\mathbf{x}$를 Back-projection하여 $\mathbf{X}_{1}, \mathbf{X}_{2}$점이 생성되었다고 했을 때, 이를 $&pi;_{\mathbf{C}^{'}}$에 프로젝션시키면 각각 $\mathbf{x}^{'}_{1} = \mathbf{P}^{'}\mathbf{X}_{1}$, $\mathbf{x}^{'}_{2} = \mathbf{P}^{'}\mathbf{X}_{2}$점들이 생성된다. 이 때 Fundamental Matrix $\mathbf{F}$에 의해
</p>

\begin{equation}
  \begin{aligned}
    &amp; \mathbf{x}^{'T}_{1}\mathbf{Fx} = 0 \\
    &amp; \mathbf{x}^{'T}_{2}\mathbf{Fx} = 0
  \end{aligned}
\end{equation}
<p>
의 관계가 성립하므로 $\mathbf{Fx}$는 $\mathbf{x}^{'T}_{i}, \ i=1,2$와 수직인 Epipolar Line $\mathbf{l}^{'}$을 의미한다.
</p>

<hr />
</div>
</div>
<div id="outline-container-org0da129e" class="outline-3">
<h3 id="org0da129e"><span class="section-number-3">2.2</span> Derivation of Fundemantal Matrix(Geometry)</h3>
<div class="outline-text-3" id="text-2-2">
<p>
두 카메라 $\mathbf{C}, \mathbf{C}^{'}$가 있을 때 이미지 평면 $\pi_{\mathbf{C}}$위의 점 $\mathbf{x}$를 Back-projection한 직선 $\mathbf{l}_{x}$가 3차원 공간 상에서 임의의 평면 $&pi;_{0}$와 한 점에서 만난다고 가정한다. 이 때 $\mathbf{C}, \mathbf{C}^{'}$의 이미지 점들을 연결해주는 Homography $\mathbf{H}_{&pi;_{0}}$를 생각해보면
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{H}_{\pi_{0}} : &amp; \pi_{\mathbf{C}} \mapsto \pi_{\mathbf{C}^{'}} \\
    &amp; \mathbf{x} \mapsto \mathbf{x}^{'} \\ 
    &amp; \mathbf{x} \mapsto \mathbf{P}^{'}(\mathbf{l_{x}} \cap \pi_{0})
  \end{aligned}
\end{equation}
<p>
$\pi_{\mathbf{C}^{'}}$위에 프로젝션된 점을 $\mathbf{x}^{'} = \mathbf{P}^{'}(\mathbf{l}_{x} &cap; &pi;_{0})$라고 하고 Epipolar Line $\mathbf{l}^{'}$을 $\mathbf{x}^{'}$와 Epipole $\mathbf{e}^{'}$를 이어주는 직선이라고 정의하면
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{e}^{'} \times \mathbf{x}^{'} &amp; = \mathbf{e}^{' \wedge}\mathbf{x}^{'} \\
    &amp; = \mathbf{e}^{'\wedge} \mathbf{H}_{\pi_{0}}(\mathbf{x}) \quad \text{is Epipolar Line.}
  \end{aligned}
\end{equation}
<p>
와 같이 나타낼 수 있다. 이 때 $\mathbf{l}^{'} = \mathbf{Fx}$의 공식을 사용하면
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{l}^{'} &amp; = \mathbf{Fx} \\
    &amp; = \mathbf{e}^{'\wedge} \mathbf{H}_{\pi_{0}} \mathbf{x} \\
  \end{aligned}
\end{equation}
<p>
과 같다. 따라서 <b>$\mathbf{F} = \mathbf{e}^{'\wedge}\mathbf{H}_{\pi_{0}}$</b> 가 성립한다.
</p>

<hr />
</div>
</div>
<div id="outline-container-org8bc1244" class="outline-3">
<h3 id="org8bc1244"><span class="section-number-3">2.3</span> Derivation of Fundemantal Matrix(Algebraic)</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Epipolar Line $\mathbf{l}^{'} = \mathbf{P}^{'}(\mathbf{X(\lambda)})$와 같다. 이 때 $\mathbf{X}(&lambda;)$는 카메라 $\mathbf{C}$의 중심점을 지나는 $\mathbf{x}$의 Back-projection 직선을 의미한다. $\mathbf{X}(&lambda;)$는 다음과 같이 다시 작성할 수 있다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{X}(\lambda) = \mathbf{P}^{\dagger}\mathbf{x} + \lambda \mathbf{C} \quad \lambda \in \mathbb{R}\\
  \end{aligned}
\end{equation}
<p>
여기서 $\mathbf{P}^{&dagger;}$는 $\mathbf{P}$의 Pseudo Inverse를 의미하고
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{P}^{\dagger} = \mathbf{P}^{T}(\mathbf{PP}^{T})^{-1}
  \end{aligned}
\end{equation}
<p>
이 때, $\mathbf{l}^{'} = \mathbf{P}^{'}(\mathbf{X}(&lambda;))$는 다음과 같다.
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{P}^{'}(\mathbf{X}(\lambda)) &amp; = \mathbf{P}^{'}\mathbf{P}^{\dagger}\mathbf{x} + \lambda \mathbf{P}^{'}\mathbf{C} \\
    &amp; \mathbf{P}^{'}\mathbf{P}^{\dagger}\mathbf{x} + \lambda \mathbf{e}^{'}
  \end{aligned}
\end{equation}
<p>
$\mathbf{P}^{'}\mathbf{C}$는 카메라 $\mathbf{C}$의 중심점을 $&pi;_{\mathbf{C}^{'}}$에 프로젝션시킨 점을 의미하므로 Epipole $\mathbf{e}^{'}$가 된다. 위 식을 Dual Projection $(\mathbb{P}^{2})^{&or;}$에서 표현하면 다음과 같다.
</p>

\begin{equation}
  \begin{aligned}
    \therefore \mathbf{l}^{'} = \mathbf{e}^{'\wedge} \mathbf{P}^{'}\mathbf{P}^{\dagger}
  \end{aligned}
\end{equation}
<p>
추가적으로 Epipole $\mathbf{e}^{'}$는 Epipolar Line $\mathbf{l}^{'}$에 포함되어 있고 모든 $\mathbf{x}_{i}$에 대해
</p>

\begin{equation}
  \begin{aligned}
    \mathbf{e}^{'} \mathbf{Fx}_{i} = 0 \quad \forall \mathbf{x}_{i}
  \end{aligned}
\end{equation}
<p>
이 성립하므로 $\mathbf{e}^{'}\mathbf{F}=0$이 성립한다. <b>결론적으로 $\mathbf{e}^{'}$는 $\mathbf{F}$의 Left null vector</b> 이다.
</p>

<hr />
</div>
</div>
</div>
<div id="outline-container-org5816cc3" class="outline-2">
<h2 id="org5816cc3"><span class="section-number-2">3</span> References</h2>
<div class="outline-text-2" id="text-3">
<p>
<a href="https://www.robots.ox.ac.uk/~vgg/hzbook/">Hartley, Richard, and Andrew Zisserman. Multiple view geometry in computer vision. Cambridge university press, 2003</a>
</p>
</div>
</div>
<div id="outline-container-org6d8d6e0" class="outline-2">
<h2 id="org6d8d6e0"><span class="section-number-2">4</span> Closure</h2>
<div class="outline-text-2" id="text-4">
<p>
PDF version is available at <a href="https://www.facebook.com/groups/slamkr/permalink/1187090471650595/">here</a>.
</p>
</div>
</div>
